# 业务需求描述

项目前端采用 react 技术，后端采用 springboot 3.3 + jdk21， 数据库采用 docker 本地运行方式（见docker目录）。
实现企业重点人员档案监测系统，本系统包含首页统计大屏、人员档案、新闻社交态势感知、重点人员库、工作区等五个主要功能。


## 前端模块划分
### 0.导航栏
横向，可以点击首页、人员档案、态势感知、重点人员库、个人工作区五个模块，最右侧有登录用户名及登录登出按钮。
### 1. 首页
展示系统数据的统计信息，中间部分展示中国地图（离线模式），围绕地图以卡片形式展示系统统计信息，中国地图的每一个省份都支持下探点击查看详情。

#### 1.1 最上展示监测人员总数、重点人员总数、今日新闻数量、新增社交动态的数量。

#### 1.2 中间展示中国地图，要求中国的每个省份可以点击下探到单独省份页面，地图省份颜色根据该省人员数量不同进行区分，人员数量越多的省份，省份颜色热度越高。
地图左上角展示机构分布统计卡片，右上角展示人员在各省活动数量排名，左下角展示人员出入境签证类型统计卡片，右下角展示人员所属群体类别统计卡片。

##### 1.2.1 机构分布统计卡片 包含人员所属的机构数量统计以及排序，卡片展示前五名机构名称及人员数量，可滚动查看所有机构情况，并可展开形成弹窗展示全部情况。

##### 1.2.2 活跃省份排名统计卡片（支持筛选全部、昨日新增、驻留）
“全部”为个省份人员数量展示，数量越多省份排名越靠前，展示前5名省份，其余省份可滚动查看；“昨日新增”为昨天到达各个省份的人员的数量，数量越多省份排名越靠前，展示前5名省份，其余省份可滚动查看；“昨日流出”为昨日离开各省的人员数量；“驻留”为该省份留下的人员的数量，计算方式为“驻留”加上“昨日新增”，减去“昨日流出”。以上数量及到达情况均通过民航铁路实时信息进行计算。

##### 1.2.3 出入境签证类型卡片 根据人员行程数据（person_travel.visa_type）中的签证类型进行统计排名，包含公务签证、旅游签证、记者签证等，展示前 5 名并可滚动查看 TOP15。

##### 1.2.4 人员类别卡片 根据人员信息中的业务标签统计人员数量并进行排名。

#### 1.3 点击地图上某个省份查看详情时，中间可以单独展示单独省份的地图，以各市包含人员数量多少进行着色，数量越多，颜色热度越高，地图周围展示卡片为将全国地图展示的卡片内容换为该省范围信息及数量统计内容。

#### 1.4 点击地图上各个卡片的内容时，自动弹出该省、机构、市人员档案卡片，并可以点击查看人员档案详情。 

## 2. 人员档案
通过标签筛选来筛选展示人员卡片，整个页面由导航栏、筛选标签和人员卡片展示三个模块组成。

### 2.1 导航栏同首页

### 2.2 标签筛选功能。

包含三级标签，一级标签共六个大类 基本属性、身份属性、组织机构、异常行为、关系属性、行为规律，采用doris4.0数据库存储。首次进入系统时，计算每个标签人员数量，并跟随在标签名称后。字体组件样式尽可能小一些，给人员卡片留出位置

#### 2.2.1 基本属性标签 包含年龄（50后、60后、70后...通过人员信息的出生日期计算），性别（男、女），教育水平（高中及以下、本科、硕士及以下）、原籍地（河南省、河北省...）、拥有境外社交媒体（X、FB）、入境签证类型（公务签证、外交签证、记者签证、旅游签证、其他）

#### 2.2.2 身份属性标签 包含外国（2015年后长期出国、2020年后出国、出入第三国）、留学生（留学生、毕业后来华）

#### 2.2.3 组织结构标签 包含1机构、2机构、3机构、4机构、5机构、6机构

#### 2.2.4 异常行为标签 包括特殊人群（1类、2类、3类、4类、5类），高消费群体（曾住高档酒店、铁路一等/商务座），小众APP（境外社交、金融借贷、涉黄赌毒、音视频），其他。

#### 2.2.5 关系属性标签 同行人员、个人关系、通讯录好友。

#### 2.2.6 行为规律标签 历史出国频次（高>=10,中5-10，低<5），常活动城市（北京、沈阳、丹东...），近三年出国频次（2次及以下、2-5次、5-10次、10次以上），国内大范围出行（国内到访城市>5），往返第三国，出国未归，多次快进快出。

### 2.3 人员展示 展示根据标签筛选展示人员卡片，每页展示20个人员卡片，每行展示5个，模块最下方可进行翻页和页面跳转操作。

#### 2.3.1 人员卡片上要显示人员的照片、姓名、证件号、出生日期、业务标签和最后更新时间，点击人物卡片可跳转到人员详情页。
#### 2.3.2 人员详情页以简历形式展示，最上部展示照片、姓名、业务标签。基本信息（证件号、手机号、出生日期、邮箱、职业、邮箱），教育经历，工作经历，民航铁路信息（以时间轴形式展示航班、车次详情，左侧展示航班，右侧展示车次，默认展示最新三次，可展开），社交媒体动态（每款社交软件一个卡片，按时间顺序展示最新社交动态，可展开或滚动查看全部信息）。
## 3. 重点人员库
### 3.1 上部导航栏同首页
### 3.2 导航栏下左侧部分有重点人员库目录，可以列表形式展示所有重点人员库名称。
### 3.3 导航栏下右侧部分以人员卡片形式，展示左侧目录选中的人员库，每页展示16个卡片，可页面跳转。
## 4. 态势感知
包含导航栏、新闻动态、社交动态、新闻分析、社交分析
### 4.1 导航栏同首页

### 4.2 新闻动态模块

以卡片形式展示相关新闻，按日期进行排序，并且可以搜索关键词查找新闻，点入新闻可查看详情。

### 4.3 社交动态模块

以卡片形式展示社交动态内容，按社交平台进行展示，每个社交平台可点击查看发言详情和动态详情。

### 4.4 新闻分析

对新闻数据进行排名，选出今日热点排行前十，同步进行词云绘制。按新闻类别进行分类，并绘制图表。
### 4.5 社交分析

对社交数据进行排名，选出今日热点排行前十，同步进行词云绘制。按社交类别进行分类，并绘制图表。

## 5. 工作区

工作区分为两个模块，数据管理和模型管理。可通过二级菜单进行模块切换

### 5.1 人员档案导入融合
用户可以针对上传的文件（Word和 excel，csv 两类数据）进行任务档案智能化（大模型）提取，并根据提取结果比对数据库中是否存在相似的人员档案（相似档案判断条件:原始姓名+出生日期+性别+国籍）。  

将文本抽取为结构化人物数据使用大模型实现，使用OpenAI标准接口实现，采用阿里云百炼的 Qwen3模型， APIkey为=sk-3557896ee7d34bdf94e4f88093eec565， 模型名称和调用地址支持在前端配置。

在用户导入人物档案Excel，csv，pdf，doc，docx后，使用OpenAI标准格式的接口，QWEN3大模型提取结构化的档案信息JSON格式（结构化参考doris 中的 person 表 ），大模型抽取完成后支持用户进行原始文档阅读和抽取后的人物信息进行对比查看，支持人工确认后导入。档案融合上传后的文件支持 **OnlyOffice 预览** 和 **下载**：任务列表与任务详情页提供「预览」「下载」按钮；预览需启动 OnlyOffice Document Server（见 `docker/docker-compose-onlyoffice.yml`），并在后端 `application.yml` 中配置 `onlyoffice.document-server-url` 与 `onlyoffice.document-download-base`（OnlyOffice 服务端拉取文档的后端基地址，Docker 内可填 `http://host.docker.internal:8000/api`）。

### 5.2 模型管理
用户可以新建模型，通过建模的方式精细化锁定重点人员，运行模型可通过模型计算来展示所有符合要求人员卡片，形成新的页面展示这些人员。用户可新增、删除模型。模型计算结果进行版本保存。

### 5.3 数据管理

数据管理分为两大板块，个人区和公共区，个人区和公共区均支持类似网络云盘的各类文件上传、下载、管理，支持文件夹管理，文档的图标完全采用 word类似的图标。

系统支持用户登录功能，公共区的文档所有人可见，个人区的文档只有当前用户可见。


## 数据存储模型设计
结构化数据采用 doris 4.0 存储，涉及到的数据表如下, 初始化脚本存储在 doris/01-init-schema.sql 文件中
### 1. 人物表 (Unique Key 模型)
### 2. 人物行为活动数据人物行程表 (Unique Key 模型)
### 3.人物社交动态表 (Unique Key 模型)
### 4. 新闻表 (Unique Key 模型)
### 5. 标签表 (Unique Key 模型)
### 6. 目录表 (Unique Key 模型)
### 7. 上传文档表 (Unique Key 模型)
### 8. 文档分块表 (支持向量检索)
### 9. 问答历史表 (优化版)

## 存储选型
采用 docker-compose 运行存储采用 doris4.0，非结构化存储采用 seaweedfs 存储， docker-compose 文件均存储在项目 docker 目录下

## 架构/前后端设计
### 1. 系统分层
- **前端层（React 18 + Vite）**：负责页面渲染、交互逻辑、可视化大屏与地图、路由与状态管理。
- **后端层（Spring Boot 3.3 + JDK21）**：提供统一 REST API、权限控制、数据聚合与统计计算、异步任务调度。
- **数据层（Doris 4.0 + SeaweedFS）**：结构化数据存储与检索、文档与图片非结构化存储、向量检索支持。
- **基础能力**：鉴权与审计、缓存（热点统计）、全文检索与向量检索、日志与监控。

### 2. 前端模块与路由
- `/dashboard` 首页统计大屏：地图下钻、卡片统计、排名展示。
- `/persons` 人员档案：标签筛选、分页、人员详情。
- `/key-persons` 重点人员库：库目录、卡片列表。
- `/situational` 态势感知：新闻动态、社交动态、分析图表。
- `/workspace` 工作区：数据管理（文件/目录）、模型管理、档案融合。

### 3. 后端模块职责
- **Auth**：登录、会话、用户信息、权限控制（公共/个人区）。
- **Dashboard**：统计指标聚合、地图数据、排名计算。
- **Person**：档案查询、标签统计、详情聚合（行程/社交/新闻）。
- **KeyPerson**：重点人员库目录管理与人员列表。
- **Situational**：新闻/社交动态查询与分析统计。
- **Workspace**：文件管理、模型管理、档案融合任务与结果。

### 4. 关键数据流（概述）
1. **首页统计**：Dashboard API 聚合 Doris 统计结果 -> 前端大屏渲染地图与卡片。
2. **人员档案**：标签查询 -> 人员分页列表 -> 详情页聚合行程与社交数据。
3. **态势感知**：新闻/社交列表查询 -> 热点分析 -> 词云与排行。
4. **工作区**：文件上传至 SeaweedFS -> 元数据写入 Doris -> 可检索与融合任务。

## 需求拆分为实现任务
### 1. 基础设施与认证
- 登录/登出与用户信息接口、会话管理、权限校验（公共区/个人区）。
- 统一错误码与响应体、分页返回结构。
- 产出：Auth API、公共响应 DTO、权限拦截器、单元测试。

### 2. 首页统计大屏
- 全国/省级地图数据接口、下钻逻辑与省份热度计算。
- 机构分布、活跃省份、签证类型、人员类别统计接口。
- 产出：Dashboard API、统计聚合服务、可视化组件。

### 3. 人员档案
- 三级标签树与标签统计数量接口。
- 人员筛选与分页、人员详情聚合（基本信息、行程、社交动态）。
- 产出：Person API、标签服务、详情聚合服务、详情页组件。

### 4. 重点人员库
- 重点人员库目录查询、库内人员分页列表。
- 产出：KeyPerson API、人员卡片复用、库目录组件。

### 5. 态势感知
- 新闻与社交动态列表、关键词搜索、详情查看。
- 热点排行、词云数据、分类统计接口。
- 产出：Situational API、分析统计服务、图表组件。

### 6. 工作区
- 目录树与文件列表、上传/下载/删除、权限控制（个人/公共）。
- 模型管理（新建/删除/运行/结果版本）。
- 档案融合任务（解析文件->提取->相似匹配）。
- 产出：Workspace API、文件服务、模型任务服务、融合任务服务。
