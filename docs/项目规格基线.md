# Star Archive 项目规格基线

本文档描述**当前已实现模块与契约基线**，供新特性规格编写时引用（如“在人员档案模块上扩展”“与首页统计 API 一致”）。实现细节以代码为准，此处仅作索引与摘要。

---

## 一、后端模块与 API 契约

所有 API 前缀为 `/api`（前端通过 `baseURL: '/littlesmall/api'` 访问）。响应统一为 `ApiResponse<T>` 或分页 `PageResponse<T>`。

| 模块 | Controller | 路径前缀 | 主要能力摘要 |
|------|------------|----------|--------------|
| 认证 | AuthController | `/auth` | 登录、登出、当前用户 |
| 首页统计 | DashboardController | `/dashboard` | 统计数据、地图、机构/签证/群体排行、省份排行与流动、行程趋势、省份下钻统计 |
| 人员档案 | PersonController | `/persons` | 分页列表、按标签查询、详情、更新、软删、头像上传、编辑历史、智能画像（含流式）、标签 CRUD |
| 重点人员库 | KeyPersonLibraryController | `/key-person-library` | 目录树、分类、人员列表、目录下人员、移除人员 |
| 模型管理 | ModelManagementController | `/models` | 模型 CRUD、启动/暂停、锁定人员列表、语义命中分页、规则配置 |
| 工作区·档案融合 | ArchiveFusionController | `/workspace/archive-fusion` | 创建任务（单/批量）、任务列表、重试/删除、文件下载、预览配置、任务详情、抽取结果、确认导入 |
| 智能问答 | SmartQaController | `/smart-qa` | 知识库文档上传/列表/删除、会话 CRUD、会话消息、流式对话 |
| 知识库 | KnowledgeBaseController | `/smart-qa/knowledge-bases` | 知识库 CRUD |
| 系统配置 | SystemConfigController | `/system-config` | 公开配置、完整配置、更新配置、Logo 上传 |
| 系统用户 | SysUserController | `/sys/users` | 用户列表、创建、删除 |
| 新闻 | NewsController | `/news` | 列表、详情 |
| 事件 | EventController | `/events` | 列表、详情 |
| 社交动态 | SocialDynamicController | `/social-dynamics` | 列表 |
| 用户收藏 | UserFavoriteController | `/user-favorites` | 收藏/取消、是否已收藏、收藏列表 |
| 头像 | AvatarController | `/avatar` | 按文件 ID 获取图片 |

**DTO 与实体**：请求/响应结构见 `backend/.../dto/`，表结构见 `backend/.../entity/`；数据库表定义以 `docker/init-db/01-init-schema.sql` 为准。

---

## 二、前端模块与路由

| 路由/页面 | 目录 | 主要能力摘要 |
|-----------|------|--------------|
| 登录 | `pages/Login` | 登录表单、跳转 |
| 首页 | `pages/Dashboard` | 统计卡片、地图、省份下钻 `ProvinceDetail` |
| 人员档案 | `pages/PersonList` | 标签筛选、人员卡片列表、分页 |
| 人员详情 | `pages/PersonDetail` | 简历式展示、行程、社交、收藏、智能画像（流式） |
| 重点人员库 | `pages/KeyPersonLibrary` | 目录与人员列表 |
| 态势感知 | `pages/SituationAwareness` | 新闻/社交、新闻详情 `NewsDetail` |
| 智能问答 | `pages/SmartQA` | 知识库、会话、流式对话 |
| 工作区 | `pages/Workspace` | 数据管理（Data/Favorites/Tags）、档案融合（Fusion）、导入详情（ImportDetail）、预览（Preview） |
| 模型管理 | `pages/ModelManagement` | 模型 CRUD、规则配置、语义命中人员 |
| 系统配置 | `pages/SystemConfig` | 导航开关、大模型配置、OnlyOffice、用户管理 |

**API 与类型**：`frontend/src/services/api.ts` 中按模块导出（如 `authAPI`、`dashboardAPI`、`personAPI` 等），类型与后端 DTO 对应；领域类型见 `frontend/src/types/`。

---

## 三、核心数据实体（表/Entity 摘要）

| 实体/表 | 说明 |
|---------|------|
| person | 人物档案；person_id 主键；含标签、可见性 is_public/created_by、软删 deleted |
| person_travel | 人物行程；用于首页省份排行、流动、趋势及人员详情行程 |
| person_social_dynamic | 社交动态 |
| news | 新闻 |
| event / event_news | 事件及事件-新闻关联 |
| prediction_model / prediction_model_locked_person | 模型及锁定人员 |
| archive_import_task / archive_extract_result / archive_similar_match | 档案融合任务、抽取结果、相似匹配 |
| qa_document / qa_chunk / qa_session / qa_message | 智能问答知识库与会话 |
| system_config | 系统配置（键值存储） |
| sys_user | 系统用户 |
| user_favorite_person | 用户收藏人物 |
| tag | 标签树 |
| key_person 相关目录/分类 | 重点人员库结构 |

人物可见性规则：`is_public=1` 或 `created_by=当前用户` 的档案对当前用户可见；列表与详情接口均按此过滤。

---

## 四、规格引用方式

- 在**功能规格**中可写：“在现有**人员档案**模块上增加……”“与**首页统计**的省份下钻接口一致，返回……”
- 在**技术计划**中可写：“新增 Controller 在 `controller/` 下，DTO 在 `dto/` 下，与现有 `ApiResponse` 一致”“前端在 `pages/xxx` 下新增页面，在 `api.ts` 中新增对应接口与类型。”
- **契约一致性**：新增或变更 API 时，后端 DTO 与前端 `api.ts` 中的类型需同步更新；表结构变更需体现在 `docker/init-db/` 的 schema 或迁移脚本中。

---

## 五、相关文档

- **项目宪法与原则**：`.specify/memory/constitution.md`
- **规格驱动流程说明**：`docs/规格驱动编程说明.md`
- **技术计划模板**：`.specify/templates/plan-template.md`（含本项目 Technical Context 与 Project Structure）
- **业务需求**：`docs/智能监测系统-实现方案.md`
- **流程说明**：如 `docs/新闻到事件流程说明.md`
